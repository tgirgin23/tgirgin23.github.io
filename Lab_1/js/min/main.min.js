window.onload=function(){function t(t){var e=[],o=1/0,n=-1/0;for(var a in t.features){var i=t.features[a].properties;for(var r in i)"id"!=r&&"name"!=r&&"lat"!=r&&"lon"!=r&&(i[r]=String(i[r]).slice(0,-1).split("("),m=i[r.split(",")],-1===$.inArray(r,e)&&e.push(r),Number(m[1])<o&&(o=Number(m[1])),Number(m[1])>n&&(n=Number(m[1])))}return{timestamps:e,min:o,max:n}}function e(t,e){s=L.geoJson(e,{pointToLayer:function(t,e){return L.circleMarker(e,{fillColor:"#8A0707",color:"#8E0707",weight:1,fillOpacity:.6}).on({mouseover:function(){this.openPopup(),this.setStyle({color:"yellow"})},mouseout:function(){this.closePopup(),this.setStyle({color:"#537898"})}})}}).addTo(p),o(t[0])}function o(t){s.eachLayer(function(e){var o=e.feature.properties,a=n(o[t]),i="<b>"+String(o[t][1])+" homicides</b><br><i>"+o.name+"</i> in </i>"+t+"</i>";e.setRadius(a),e.bindPopup(i,{offset:new L.Point(0,-a+5)})})}function n(t){var e=35,o=Number(t[1])*e;return 2*Math.sqrt(o/Math.PI)}function a(t,e){function o(t){return Math.round(t)}1>t&&(t=1);var a=L.control({position:"bottomright"});a.onAdd=function(){var a,i,r,p=L.DomUtil.create("div","legend"),s=L.DomUtil.create("div","symbolsContainer"),l=[o(t),o((e-t)/2),o(e)],m=0;L.DomEvent.addListener(p,"mousedown",function(t){L.DomEvent.stopPropagation(t)}),$(p).append("<h2 id='legendTitle'>Number of </br>homicides</h2>");for(var u=0;u<=l.length-1;u++)a=L.DomUtil.create("div","legendCircle"),i=n([0,l[u]]),r=-i-m,$(a).attr("style","width: "+2*i+"px; height: "+2*i+"px; margin-left: "+r+"px"),$(a).append("<span class = 'legendValue'>"+l[u]+"<span>"),$(s).append(a),m=i;return $(p).append(s),p},a.addTo(p)}function i(t){var e=L.control({position:"bottomleft"});e.onAdd=function(){var e=L.DomUtil.create("input","range-slider");return L.DomEvent.addListener(e,"mousedown",function(t){L.DomEvent.stopPropagation(t)}),$(e).attr({type:"range",max:t[t.length-1],min:t[0],step:1,value:String(t[0])}).on("input",function(){o($(this).val().toString()),$(".temporal-legend").text(this.value)}),e},e.addTo(p),r(t[0])}function r(){var t=L.control({position:"bottomleft"});t.onAdd=function(){var t=L.DomUtil.create("output","temporal-legend");return t},t.addTo(p)}var p,s,l,m=[];p=L.map("map",{center:[50,22.316667],zoom:4}),l=L.tileLayer("http://{s}.tiles.mapbox.com/v3/examples.map-y7l23tes/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoidGdpcmdpbiIsImEiOiIxV0ExandNIn0.T0lIyQKqIktV__nqnLSxCQ",{attribution:'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="http://mapbox.com">Mapbox</a>',maxZoom:7}).addTo(p),$.getJSON("data/map.geojson").done(function(o){var n=t(o);e(n.timestamps,o),a(n.min,n.max),i(n.timestamps),console.log("Loaded the data successfully!")}).fail(function(){alert("There has been a problem loading the data")})};