window.onload=function(){function e(e){var o=[],t=1/0,n=-1/0;for(var a in e.features){var r=e.features[a].properties;for(var i in r)"id"!=i&&"name"!=i&&"lat"!=i&&"lon"!=i&&(r[i]=String(r[i]).slice(0,-1).split("("),m=r[i.split(",")],-1===$.inArray(i,o)&&o.push(i),Number(m[1])<t&&(t=Number(m[1])),Number(m[1])>n&&(n=Number(m[1])))}return{timestamps:o,min:t,max:n}}function o(e,o){s=L.geoJson(o,{pointToLayer:function(e,o){return L.circleMarker(o,{fillColor:"#8A0707",color:"#8E0707",weight:1,fillOpacity:.6}).on({mouseover:function(){this.openPopup(),this.setStyle({color:"yellow"})},mouseout:function(){this.closePopup(),this.setStyle({color:"#8A0707"})}})}}).addTo(p),u=jQuery.extend(!0,{},s),p.fitBounds(s.getBounds()),t(e[0])}function t(e){s.eachLayer(function(o){var t=o.feature.properties,a=n(t[e]),r="<b>"+String(t[e][1])+" homicide/100,000</b><br><i>"+t.name+"</i> in </i>"+e+"</i>";o.setRadius(a),o.bindPopup(r,{offset:new L.Point(0,-a+4)})})}function n(e){var o=50,t=Number(e[1])*o;return 2*Math.sqrt(t/Math.PI)}function a(e,o){function t(e){return Math.round(e)}1>e&&(e=1);var a=L.control({position:"bottomright"});a.onAdd=function(){var a,r,i,l=L.DomUtil.create("div","legend"),p=L.DomUtil.create("div","symbolsContainer"),s=[t(e),t((o-e)/2),t(o)],d=0;L.DomEvent.addListener(l,"mousedown",function(e){L.DomEvent.stopPropagation(e)}),$(l).append("<h3 id='legendTitle'><b>Homicides</b></h3>\n <h5 id='legendTitle'>Per 100,000</h5>");for(var c=0;c<=s.length-1;c++)a=L.DomUtil.create("div","legendCircle"),r=n([0,s[c]]),i=-r-d,$(a).attr("style","width: "+2*r+"px; height: "+2*r+"px; margin-left: "+i+"px"),$(a).append("<span class = 'legendValue'>"+s[c]+"<span>"),$(p).append(a),d=r;return $(l).append(p),l},a.addTo(p)}function r(){var e=new L.Control.Search({layer:u,propertyName:"name",circleLocation:!0});return e.on("search_locationfound",function(e){e.layer._popup&&e.layer.openPopup()}),e}function i(e){console.log(e);var o=L.control({position:"topright"});o.onAdd=function(){var o=L.DomUtil.create("input","range-slider");return L.DomEvent.addListener(o,"mousedown",function(e){L.DomEvent.stopPropagation(e)}),$(o).attr({type:"range",max:e[e.length-1],min:e[0],step:1,value:String(e[0])}).on("input",function(){t($(this).val().toString()),$(".temporal-legend").text(this.value)}),o},o.addTo(p),l(e[0])}function l(e){var o=L.control({position:"topright"});o.onAdd=function(){var e=L.DomUtil.create("span","temporal-legend");return e},o.addTo(p),$(".temporal-legend").text(e)}var p,s,d,c,u,m=[];p=L.map("map",{center:[50,13.316667],zoom:4,zoomsliderControl:!0,zoomControl:!1}),d=L.tileLayer("http://{s}.tiles.mapbox.com/v3/examples.map-y7l23tes/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoidGdpcmdpbiIsImEiOiIxV0ExandNIn0.T0lIyQKqIktV__nqnLSxCQ",{attribution:'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="http://mapbox.com">Mapbox</a>',maxZoom:7,minZoom:3}).addTo(p),p.addControl(new L.Control.Scale);var f=new L.LayerGroup;p.addLayer(f),$.getJSON("data/map.geojson").done(function(t){var n=e(t);o(n.timestamps,t),a(n.min,n.max),c=r(t),i(n.timestamps),p.addControl(c),console.log("Loaded the data successfully!")}).fail(function(){alert("There has been a problem loading the data")})};