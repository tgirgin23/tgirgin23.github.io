window.onload=function(){function e(e){var t=[],o=1/0,n=-1/0;for(var a in e.features){var r=e.features[a].properties;for(var i in r)"id"!=i&&"name"!=i&&"lat"!=i&&"lon"!=i&&(r[i]=String(r[i]).slice(0,-1).split("("),u=r[i.split(",")],-1===$.inArray(i,t)&&t.push(i),Number(u[1])<o&&(o=Number(u[1])),Number(u[1])>n&&(n=Number(u[1])))}return{timestamps:t,min:o,max:n}}function t(e,t){d=L.geoJson(t,{pointToLayer:function(e,t){return L.circleMarker(t,{fillColor:"#8A0707",color:"#8E0707",weight:1,fillOpacity:.6}).on({mouseover:function(){this.openPopup(),this.setStyle({color:"yellow"})},mouseout:function(){this.closePopup(),this.setStyle({color:"#8A0707"})}})}}).addTo(p),c=jQuery.extend(!0,{},d),o(e[0])}function o(e){d.eachLayer(function(t){var o=t.feature.properties,a=n(o[e]),r="<b>"+String(o[e][1])+" homicide rate</b><br><i>"+o.name+"</i> in </i>"+e+"</i>";t.setRadius(a),t.bindPopup(r,{offset:new L.Point(0,-a+4)})})}function n(e){var t=50,o=Number(e[1])*t;return 2*Math.sqrt(o/Math.PI)}function a(e,t){function o(e){return Math.round(e)}1>e&&(e=1);var a=L.control({position:"bottomright"});a.onAdd=function(){var a,r,i,l=L.DomUtil.create("div","legend"),p=L.DomUtil.create("div","symbolsContainer"),d=[o(e),o((t-e)/2),o(t)],s=0;L.DomEvent.addListener(l,"mousedown",function(e){L.DomEvent.stopPropagation(e)}),$(l).append("<h3 id='legendTitle'>Homicide</br> rates</h2>\n <h5 id='legendTitle'>Per 100,000</h5>");for(var m=0;m<=d.length-1;m++)a=L.DomUtil.create("div","legendCircle"),r=n([0,d[m]]),i=-r-s,$(a).attr("style","width: "+2*r+"px; height: "+2*r+"px; margin-left: "+i+"px"),$(a).append("<span class = 'legendValue'>"+d[m]+"<span>"),$(p).append(a),s=r;return $(l).append(p),l},a.addTo(p)}function r(){var e=new L.Control.Search({layer:c,propertyName:"name",circleLocation:!0});return e.on("search_locationfound",function(e){e.layer._popup&&e.layer.openPopup()}),e}function i(e){console.log(e);var t=L.control({position:"bottomleft"});t.onAdd=function(){var t=L.DomUtil.create("input","range-slider");return L.DomEvent.addListener(t,"mousedown",function(e){L.DomEvent.stopPropagation(e)}),$(t).attr({type:"range",max:e[e.length-1],min:e[0],step:1,value:String(e[0])}).on("input",function(){o($(this).val().toString()),$(".temporal-legend").text(this.value)}),t},t.addTo(p),l(e[0])}function l(e){var t=L.control({position:"bottomleft"});t.onAdd=function(){var e=L.DomUtil.create("div","temporal-legend");return e},t.addTo(p),$(".temporal-legend").text(e)}var p,d,s,m,c,u=[];p=L.map("map",{center:[50,22.316667],zoom:4,zoomsliderControl:!0,zoomControl:!1}),s=L.tileLayer("http://{s}.tiles.mapbox.com/v3/examples.map-y7l23tes/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoidGdpcmdpbiIsImEiOiIxV0ExandNIn0.T0lIyQKqIktV__nqnLSxCQ",{attribution:'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="http://mapbox.com">Mapbox</a>',maxZoom:7,minZoom:3}).addTo(p),p.addControl(new L.Control.Scale);var f=new L.LayerGroup;p.addLayer(f),$.getJSON("data/map.geojson").done(function(o){var n=e(o);t(n.timestamps,o),a(n.min,n.max),m=r(o),i(n.timestamps),p.addControl(m),console.log("Loaded the data successfully!")}).fail(function(){alert("There has been a problem loading the data")})};